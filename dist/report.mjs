var N=Object.defineProperty,A=(t,e,s)=>e in t?N(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,F=(t,e,s)=>(A(t,typeof e!="symbol"?e+"":e,s),s),R=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},r=(t,e,s)=>(R(t,e,"read from private field"),s?s.call(t):e.get(t)),h=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},a=(t,e,s,n)=>(R(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s);import{Assertion as I}from"./assert.mjs";import"dequal";import"diff";const g="uvub-report:ready",D=new Intl.NumberFormat([],{maximumFractionDigits:2,minimumFractionDigits:2,style:"unit",unit:"millisecond",unitDisplay:"short"}),P=t=>t.trim();function U(t){const e=t?.indexOf(`
`)??-1;return e<0?"":t.substring(e).split(`
`).map(P).join(`
`)}function B(t){const[e,s,n]=t;let i="",o="",c="";return e instanceof Error?(e.name&&(i=e.name),e.message&&(i=i?`${i}: ${e.message}`:e.message),e instanceof I&&e.operator&&(o=e.operator),typeof e.stack=="string"&&(c=U(e.stack))):typeof e=="string"?i=e:i=String(e),{suiteName:n,testName:s,message:i,operator:o,stack:c}}function S(t){const e=document.getElementById(t);if(!(e instanceof HTMLTemplateElement))throw new Error("${id} template not found");return e}const M=t=>{var e;return(e=t.content.firstElementChild)==null?void 0:e.cloneNode(!0)},O="uvub-report-suite";let L;function _(){const t=M(L||(L=S(O)));if(!(t instanceof HTMLTableRowElement))throw new Error("cloneSuiteTemplate: Incorrect root type");return t}const V="uvub-report-failure";let H;function Y(){const t=M(H||(H=S(V)));if(!(t instanceof HTMLTableSectionElement))throw new Error("cloneFailureTemplate: Incorrect root type");return t}const z="uvub-report-error";let x;function G(){const t=M(x||(x=S(z)));if(!(t instanceof HTMLTableRowElement))throw new Error("cloneErrorTemplate: Incorrect root type");return t}const J="uvub-report-summary";let $;function K(){const t=M($||($=S(J)));if(!(t instanceof HTMLTableElement))throw new Error("cloneSummaryTemplate: Incorrect root type");return t}var l,u,p,v;class Q{constructor(e){h(this,l,void 0),h(this,u,void 0),h(this,p,void 0),h(this,v,void 0),F(this,"render",()=>{if(r(this,l)!==void 0){for(const s of r(this,u))switch(s.kind){case"suite-start":r(this,l).renderSuiteStart(s.name);break;case"suite-test":r(this,l).renderSuiteTest(s.passed);break;case"suite-result":r(this,l).renderSuiteResult(s.selected,s.passed,s.skipped,s.errors.map(B));break;case"end-result":{const n=`${s.endResult.total}`,i=`${s.endResult.done}`,o=`${s.endResult.skipped}`,c=D.format(s.endResult.duration);r(this,l).renderSummary({withErrors:s.endResult.withErrors,withSkips:s.endResult.skipped>0,total:n,passed:i,skipped:o,duration:c});break}}a(this,p,void 0),r(this,u).length=0}}),a(this,l,e),a(this,u,[]),a(this,p,void 0),a(this,v,void 0)}suiteStart(e){r(this,l)!==void 0&&(r(this,u).push({kind:"suite-start",name:e}),this.scheduleRender())}suiteResult(e,s,n,i){console.log("suiteResult",e,s,n,i),r(this,l)!==void 0&&(r(this,u).push({kind:"suite-result",selected:s,passed:n,skipped:i,errors:e}),this.scheduleRender())}testPass(){r(this,l)!==void 0&&(r(this,u).push({kind:"suite-test",passed:!0}),this.scheduleRender())}testFail(){r(this,l)!==void 0&&(r(this,u).push({kind:"suite-test",passed:!1}),this.scheduleRender())}result(e){r(this,l)!==void 0&&(r(this,u).push({kind:"end-result",endResult:e}),this.scheduleRender())}isAttached(){return r(this,l)!==void 0}detach(){r(this,p)&&clearTimeout(r(this,p)),a(this,p,void 0),r(this,u).length=0,a(this,l,void 0),r(this,v)&&r(this,v).call(this),a(this,v,void 0)}onDetach(e){a(this,v,e)}scheduleRender(){r(this,p)||a(this,p,setTimeout(this.render))}}l=new WeakMap,u=new WeakMap,p=new WeakMap,v=new WeakMap;function X(t,e){const s=_(),n=s.querySelector("th"),i=s.querySelector(".js-uvb-report-test-count"),o=s.querySelector(".js-uvb-report-test-indicator");if(!(n instanceof HTMLTableCellElement&&i instanceof HTMLTableCellElement&&o instanceof HTMLTableCellElement))throw new Error("prepareSuite: Missing references");const c=`suite${e}`;return n.setAttribute("id",c),n.textContent=t,i.headers=c,o.headers=c,[s,{header:n,count:i,indicators:o,id:c,outcomes:[]}]}function Z(t,e){t.outcomes.push(e?"\u2022":"\u2718");const s=t.outcomes.join(" ");t.indicators.innerHTML=s}function ee(t,e,s,n,i){t.count.textContent=`(${s}/${e})`;const o=i>0?"uvb-report--fail":n>0?"uvb-report--skip":"uvb-report--pass";t.count.classList.add(o)}function te(t,e,s,n,i){var o;const c=Y(),d=c.querySelector("th"),E=c.querySelector("td"),y=c.querySelector("span");if(!(d instanceof HTMLTableCellElement&&E instanceof HTMLTableCellElement&&y instanceof HTMLSpanElement))throw new Error("renderTestFailure: Missing references");const C=`fail${s}`;if(d.textContent=t,d.setAttribute("id",C),E.headers=`suite${e} ${C}`,i){y.textContent=`(${i})`;const j=document.createTextNode(`${n} `);(o=y.parentNode)==null||o.insertBefore(j,y)}else E.textContent=n;return Array.from(c.children)}function se(t,e,s){const n=G(),i=n.querySelector("td"),o=n.querySelector("pre");if(!(i instanceof HTMLTableCellElement&&o instanceof HTMLPreElement))throw new Error("renderErrorStack: Missing references");return i.headers=`suite${t} fail${e}`,o.textContent=s,n}function q(){const t=K(),e=t.querySelector(".js-uvb-report-total"),s=t.querySelector(".js-uvb-report-passed"),n=t.querySelector(".js-uvb-report-skipped"),i=t.querySelector(".js-uvb-report-duration"),o=t.querySelector("tbody");if(!(e instanceof HTMLTableCellElement&&s instanceof HTMLTableCellElement&&n instanceof HTMLTableCellElement&&i instanceof HTMLTableCellElement&&o instanceof HTMLTableSectionElement))throw new Error("prepareSummary: Missing references");const c=s.parentElement;if(!(c instanceof HTMLTableRowElement))throw new Error("prepareSummary: Missing references 2");return[t,{total:e,passedRow:c,passed:s,skipped:n,duration:i,tbody:o}]}function re(t,e){const{total:s,passed:n,passedRow:i,skipped:o,duration:c}=t;s.textContent=e.total,n.textContent=e.passed;const d=i.classList;e.withErrors?(d.remove("uvb-report--pass"),d.add("uvb-report--fail")):(d.remove("uvb-report--fail"),d.add("uvb-report--pass")),o.textContent=e.skipped;const E=o.classList;e.withSkips?E.add("uvb-report--skip"):E.remove("uvb-report--skip"),c.textContent=e.duration}class W extends CustomEvent{constructor(e){super(g,{bubbles:!0,detail:e})}get reporter(){return this.detail.reporter}}var k,m,b,f,T,w;class ne extends HTMLElement{constructor(){super(),h(this,k,void 0),h(this,m,void 0),h(this,b,void 0),h(this,f,void 0),h(this,T,void 0),h(this,w,void 0),a(this,k,!1),a(this,m,0),a(this,b,0);const[e,s]=q();this.replaceChildren(e),a(this,f,s)}connectedCallback(){this.isConnected&&this.dispatchEvent(new W(this))}disconnectedCallback(){this.detach()}detach(){r(this,w)&&(r(this,w).detach(),a(this,w,void 0))}get reporter(){return this.detach(),a(this,w,new Q(this)),r(this,w)}resetSummary(){a(this,k,!1),a(this,m,0);const[e,s]=q();this.replaceChildren(e),a(this,f,s)}renderSuiteStart(e){r(this,k)&&this.resetSummary();const[s,n]=X(e,r(this,m));r(this,f).tbody.append(s),a(this,T,n),a(this,m,r(this,m)+1)}renderSuiteTest(e){if(r(this,T)===void 0)throw new Error("renderSuiteTest: expected suite");Z(r(this,T),e)}renderSuiteResult(e,s,n,i){if(r(this,T)===void 0)throw new Error("renderSuiteTest: expected suite");ee(r(this,T),e,s,n,i.length);for(const o of i){const c=te(o.testName,r(this,m),r(this,b),o.message,o.operator);if(r(this,f).tbody.append(...c),o.stack){const d=se(r(this,m),r(this,b),o.stack);r(this,f).tbody.append(d)}a(this,b,r(this,b)+1)}}renderSummary(e){a(this,k,!0),r(this,f)!==void 0&&re(r(this,f),e)}}k=new WeakMap,m=new WeakMap,b=new WeakMap,f=new WeakMap,T=new WeakMap,w=new WeakMap;export{g as UVUB_REPORT_READY,ne as UvubReport,W as UvubReportReadyEvent};
